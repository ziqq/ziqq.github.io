(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{HWsm:function(t,e,n){"use strict";var s=n("xwMf");n.n(s).a},"sD/4":function(t,e,n){"use strict";n.r(e);function s(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function c(t,e,n,s,i,r,o){try{var l=t[r](o),c=l.value}catch(t){return void n(t)}l.done?e(c):Promise.resolve(c).then(s,i)}function i(l){return function(){var t=this,o=arguments;return new Promise(function(e,n){var s=l.apply(t,o);function i(t){c(s,e,n,i,r,"next",t)}function r(t){c(s,e,n,i,r,"throw",t)}i(void 0)})}}var r,o,l,a,u={name:"clients-base",props:["name","clientsType"],data:function(t){return{bottom:!1,load:!0,loading:!1,notClients:!1,clientsNotFound:!1,clients:[],countClients:0,clients_type:[{value:0,text:"Любой"}],modelClientsType:0,modelClientsToName:"",queryArray:[],topScrollTable:0,fetchOnScroll:!1}},methods:{editClient:function(t){this.$router.push("/clients/base/".concat(t,"/edit/"))},bottomVisible:function(t){return t.scrollTop==t.scrollHeight-t.clientHeight},searchClients:(a=i(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.load=!0,this.$router.replace({query:this.queryObject}),t.prev=2,t.next=5,Vue.$fetch.get("/clients".concat(this.queryString));case 5:e=t.sent,this.clients=e.clients,this.clients.length?(this.clientsNotFound=!1,this.countClients=e.countClients):this.clientsNotFound=!0,this.load=!1,t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),console.log(t.t0);case 13:case"end":return t.stop()}},t,this,[[2,10]])})),function(){return a.apply(this,arguments)}),addNewClient:function(){this.$store.commit("UPDATE_SCROLL_TABLE",0),this.$router.push("/clients/base/add")},addClients:(l=i(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,Vue.$fetch.get("/clients".concat(1<this.queryString.length?this.queryString+"&":"?","skip=").concat(this.clients.length));case 3:e=t.sent,console.log(e),this.clients=[].concat(s(this.clients),s(e.clients)),this.loading=!1;case 7:case"end":return t.stop()}},t,this)})),function(){return l.apply(this,arguments)}),scrollControll:function(t){this.topScrollTable=t.target.scrollTop,this.fetchOnScroll&&(this.bottom=this.bottomVisible(t.target))},resetFilter:function(){this.modelClientsToName="",this.modelClientsType=0,this.load=!0,this.notClients=!1,this.clientsNotFound=!1,this.searchClients()}},computed:{queryString:function(){var t="";return this.modelClientsToName&&(t+=t.length?"&":"",t+="name=".concat(this.modelClientsToName)),this.modelClientsType&&(t+=t.length?"&":"",t+="clientsType=".concat(this.modelClientsType)),t.length?"?".concat(t):""},queryObject:function(){var t={};return this.modelClientsToName&&(t.name=this.modelClientsToName),this.modelClientsType&&(t.clientsType="".concat(this.modelClientsType)),t}},watch:{bottom:(o=i(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=7;break}if(this.fetchOnScroll=!1,e=!1,this.clients.length<this.countClients)return t.next=6,this.addClients();t.next=7;break;case 6:this.clients.length<this.countClients&&(this.fetchOnScroll=!0);case 7:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},activated:(r=i(regeneratorRuntime.mark(function t(){var e,n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.$refs.wrapper.scrollTop=this.topScrollTable,Object.keys(this.$route.query).length&&(this.modelClientsToName=this.name||"",this.modelClientsType=parseInt(this.clientsType)),JSON.stringify(this.$route.query)!==JSON.stringify(this.queryObject)&&this.$router.replace({query:this.queryObject}),t.prev=3,t.next=6,Vue.$fetch.get("/clients".concat(this.queryString));case 6:e=t.sent,console.log(e),this.clients=e.clients,this.countClients=e.countClients,this.clients_type=this.clients_type.concat(e.clients_type.map(function(t){return{text:t.name,value:t.clientTypeID}})),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),console.log(t.t0);case 16:if(this.clients.length){t.next=20;break}return Object.keys(this.queryObject).length?this.clientsNotFound=!0:this.notClients=!0,this.load=!1,t.abrupt("return");case 20:this.load=!1,this.$nextTick(function(){n.clients.length<n.countClients&&(n.fetchOnScroll=!0)});case 22:case"end":return t.stop()}},t,this,[[3,13]])})),function(){return r.apply(this,arguments)})},h=(n("HWsm"),n("KHd+")),p=Object(h.a)(u,function(){var n=this,t=n.$createElement,s=n._self._c||t;return s("v-layout",{ref:"wrapper",staticClass:"overflow-y-auto content",class:{wrap:!n.$vuetify.breakpoint.xsOnly},attrs:{id:"scroll-target"}},[s("v-container",[s("v-row",[s("v-col",{attrs:{cols:"3",xs:"12"}},[s("v-text-field",{attrs:{label:"Имя или телефон","prepend-inner-icon":"search","clear-icon":"close",clearable:"",solo:"",dense:""},on:{input:n.searchClients},model:{value:n.modelClientsToName,callback:function(t){n.modelClientsToName="string"==typeof t?t.trim():t},expression:"modelClientsToName"}})],1),n._v(" "),s("v-col",{attrs:{cols:"3",xs:"12"}},[s("v-select",{attrs:{items:n.clients_type,label:"Категория клиента",solo:"",dense:""},on:{change:n.searchClients},model:{value:n.modelClientsType,callback:function(t){n.modelClientsType=n._n(t)},expression:"modelClientsType"}})],1),n._v(" "),s("v-col",{attrs:{cols:"3","offset-sm":"3",xs:"12"}},[s("v-btn",{attrs:{large:"",dark:"",color:"primary darken",width:"100%"},on:{click:n.addNewClient}},[n._v("Добавить клиента\n                ")])],1)],1),n._v(" "),n.load?s("Loader"):n.clientsNotFound?s("Empty",{attrs:{icon:"search-table",title:"Клиенты не найдены",text:"По заданым параметрам клиентов не найдено. Пожалуйста, измените параметры поиска",buttonText:"Сбросить фильтр"},scopedSlots:n._u([{key:"emptyBtn",fn:function(){return[s("v-btn",{staticClass:"empty__btn",attrs:{color:"primary",outlined:"",large:""},on:{click:n.resetFilter}},[n._v("\n                    Сбросить фильтр\n                ")])]},proxy:!0}])}):n.notClients?s("Empty",{attrs:{icon:"users",title:"У вас пока нет клиентов",text:"Воспользуйтесь кнопкой добавить клиента и начните создавать клиентскую базу"},scopedSlots:n._u([{key:"emptyBtn",fn:function(){return[s("v-btn",{staticClass:"empty__btn",attrs:{color:"primary",large:""},on:{click:n.addNewClient}},[n._v("\n                    Добавить клиента\n                ")])]},proxy:!0}])}):s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-card",[s("v-simple-table",{scopedSlots:n._u([{key:"default",fn:function(){return[n.$vuetify.breakpoint.xsOnly?n._e():s("thead",[s("tr",[s("th",{staticClass:"text-left"},[n._v("Имя")]),n._v(" "),s("th",{staticClass:"text-left"},[n._v("Телефон")]),n._v(" "),s("th",{staticClass:"text-left"},[n._v("\n                                        Категория клиента\n                                    ")])])]),n._v(" "),s("tbody",{directives:[{name:"scroll",rawName:"v-scroll:#scroll-target",value:n.scrollControll,expression:"scrollControll",arg:"#scroll-target"}]},[n._l(n.clients,function(e){return s("tr",{key:e.clientID,on:{click:function(t){return n.editClient(e.clientID)}}},[s("td",{class:{mobile:n.$vuetify.breakpoint.xsOnly}},[s("v-avatar",{class:{mobile:n.$vuetify.breakpoint.xsOnly},attrs:{size:"40",color:"blue lighten-2"}},[s("span",{staticClass:"white--text headline"},[n._v("\n                                                "+n._s(e.name[0])+"\n                                            ")])]),n._v(" "),n.$vuetify.breakpoint.xsOnly?n._e():[n._v("\n                                            "+n._s(e.name)+"\n                                        ")]],2),n._v(" "),n.$vuetify.breakpoint.xsOnly?[s("td",[s("div",{staticClass:"column-wrap-mobile"},[s("span",[n._v("\n                                                    "+n._s(e.name)+"\n                                                ")]),n._v(" "),s("span",[n._v("\n                                                    "+n._s(e.phone)+"\n                                                ")]),n._v(" "),s("span",[n._v("\n                                                    "+n._s(e.typeName)+"\n                                                ")])])])]:[s("td",[n._v(n._s(e.phone))]),n._v(" "),s("td",[n._v(n._s(e.typeName))])]],2)}),n._v(" "),n.loading?s("tr",[s("td",{attrs:{colspan:"3",align:"center"}},[s("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1)]):n._e()],2)]},proxy:!0}])})],1)],1)],1)],1)],1)},[],!1,null,"5f896af2",null);e.default=p.exports},xwMf:function(t,e,n){}}]);